---
title: 浏览器内核原理
tags:
  - 浏览器
categories: 技术
abbrlink: 39601
date: 2021-05-12 10:20:33
---



## **浏览器结构**

- **用户界面（UI）**：包括菜单栏、工具栏、地址栏、后退/前进按钮、书签目录等，也就是能看到的除了显示页面的主窗口之外的部分；
- **浏览器引擎（Rendering engine）**：也被称为浏览器内核、渲染引擎，主要负责取得页面内容、整理信息（应用CSS）、计算页面的显示方式，然后会输出到显示器或者打印机；
- **JS解释器**：也可以称为JS内核，主要负责处理javascript脚本程序，一般都会附带在浏览器之中，例如chrome的V8引擎；
- **网络部分**：主要用于网络调用，例如：HTTP请求，其接口与平台无关，并为所有的平台提供底层实现；
- **UI后端**：用于绘制基本的窗口部件，比如组合框和窗口等；
- **数据存储**：保存类似于cookie、storage等数据部分，HTML5新增了web database技术，一种完整的轻量级客户端存储技术。

<!--more-->

## 浏览器内核定义

浏览器内核英文叫做：Rendering Engine，中文翻译很多，排版引擎、解释引擎、渲染引擎，现在流行称为浏览器内核。内核可以分成两部分：渲染引擎（layout engineer）或（Rendering Engine）和 JS 引擎。

### **1.什么是渲染引擎**？

渲染引擎是一种对HTML文档进行解析并将其显示在页面上的工具。

它负责取得网页的内容（HTML、XML、图像等等）、整理讯息（例如加入CSS等），以及计算网页的显示方式，然后会输出至显示器或打印机。

所有网页浏览器、电子邮件客户端以及其它需要编辑、显示网络内容的应用程序都需要渲染引擎。

在Mozilla将其渲染引擎（Gecko）作为独立于浏览器的一个配件之后，“渲染引擎”这个词汇才被广泛使用。也就是说，除了Mozilla浏览器，其它浏览器也可以使用Gecko作自己渲染引擎。IE的渲染引擎被称为Trident，被用在许多Windows的应用程式上。

### **2.什么是JavaScript引擎？**

JavaScript引擎就是能够提供执行JavaScript代码的运行环境

JavaScript引擎包括以下部分：

> 第一， 编译器。主要工作是将源代码编译成抽象语法树，然后在某些引擎中还包含将抽象语法树转换成字节码。
>
> 第二， 解释器。在某些引擎中，解释器主要是接受字节码，解释执行这个字节码，然后也依赖来及回收机制等。
>
> 第三， JIT工具。一个能够能够JIT的工具，将字节码或者抽象语法树转换成本地代码，当然它也需要依赖牢记
>
> 第四， 垃圾回收器和分析工具（profiler）。它们负责垃圾回收和收集引擎中的信息，帮助改善引擎的性能和功效。

### **3. 渲染引擎和JavaScript引擎之间的关系**

在网页的工作过程需要使用渲染引擎和JavaScript引擎。从模块上看，它们是两个独立的模块，分别负责完成不同的任务：

> JavaScript引擎负责解析执行JavaScript代码，而渲染引擎负责渲染网页页面。
>
> JavaScript引擎提供调用接口被渲染引擎使用，渲染引擎使用JavaScript引擎来处理JavaScript代码并获取结果。
>
> JavaScript引擎需要能够访问渲染引擎构建的DOM树，JavaScript引擎需要提供桥接的接口，渲染引擎则根据桥接接口来提供让JavaScript访问DOM的能力。

在HTML5的能力中，很多是通过JavaScript接口提供给开发者的，所以这部分同样需要根据桥接接口来实现具体类，以便让 JavaScript引擎能够回调渲染引擎的具体实现。

**注：***IE浏览器只为每个浏览器窗口启用单独的进程，而chrome浏览器却为每个tab页面启用单独的进程*，也就是说每个tab都有独立的渲染引擎实例。

### **4.浏览器渲染过程**

浏览器渲染大体上分为以下五步

> A.处理html生成 DOM（Document Object Model）Tree
>
> B.处理css生成 CSSOM（CSS Object Model）Tree
>
> C.DOM树与CSS-DOM树合并为Render树
>
> D.对Render树进行布局计算
>
> E.遍历Render树的每一个节点绘制到屏幕

#### **A.DOM树生成**

将html代码转换为一个DOM树

注意：html文档中的每一个tag标签都是一个DOM树的节点（文本节点也是） ；DOM树的根节点就是document对象 ；js动态生成的DOM节点也在DOM树上

#### **B.CSSOM树生成**

浏览器把所有的样式解析为样式结构体 （包括css样式和浏览器默认样式，当然浏览器识别不了的样式不能解析 ）
最后生成了CSSOM树

#### **C.Render树生成**

Render树叫渲染树 ，它是由DOM树和CSSOM树合成的

渲染树的每一个节点都有自己的style样式 ，渲染树上没有隐藏的节点，比如display：block和无样式head节点 ，因为这些节点不会呈现也不影响呈现

注意：visibility:hidden会存在渲染树，因为它占有空间，会影响布局

#### **D.布局计算**

根据Render树的样式计算布局 ，输出的结果称为box盒模型（width,height,margin,padding,border,left,top,…）

盒模型精确表示了每一个元素的位置和大小 ，所有相对度量单位都转化为了绝对单位

#### **E.绘制**

最后将信息渲染到屏幕中每一个真实的像素点 ，这个过程叫绘制或者rasterizing格栅化



### 5.浏览器内核分类：

- **Trident(IE 内核)：**

  ​	1997年 --IE4首次采用 ，微软 基于Mosaic代码修改而来

  ​	一款开放的内核，核心内核相当成熟	

- **Gecko(Firefox 内核):** 

  ​	Netscape6（网景）/FireFox (火狐浏览器)  采用该内核

  ​	特点：代码完全公开。其可开发程度很高，全世界的程序员都可以为其编写代码，增加功能。

- **Presto(Opera 前内核)(已废弃):** 

  ​	Opera12.17及更老版本使用的内核（废弃）

  ​	特点：渲染速度的优化达到了极致

  ​	缺点：牺牲了网页的兼容性

  ​	Opera 现在采用的是 Webkit 内核，并已宣布最终会转向谷歌的 Blink 内核。

- **Webkit(Safari 内核,Chrome 内核原型,开源):** 

  ​	苹果公司的内核，苹果的 Safari 浏览器使用的内核。

  ​	Webkit 引擎包含 WebCore 排版引擎及 JavaScriptCore 解析引擎，均是从 KDE 的 KHTML 及 KJS 引擎衍生而来。

- **Blink（谷歌开发，并正在不断完善）:**

  ​	 Google（主导） 和 Opera（参与） 开发的浏览器排版引擎

   	这一渲染引擎是开源引擎 WebKit 中 WebCore 组件的一个分支，Chrome（28 及往后版本）、Opera（15 及往后版本）和 Yandex 浏览器中使用

